      PROGRAM TAX01(INPUT,OUTPUT,TAPE5=INPUT,TAPE6=OUTPUT)
CTAX01     NUMERICAL TAXONOMY
C          BASED ON PERCENTAGE OF CHARACTERS SIMILAR
C          IN ANY COMPARISON OF TWO SPECIES, ANY CHARACTER WHICH CONTAINS
C          A 9 IN EITHER ONE IS IGNORED
      DIMENSION IB(60,70),B(60,2),A(60,60),KA(60),C(60),KB(60),E(100),
     1T(60,60),IP(70),IG(7),TN(60)
      DIMENSION TIPE(10)
      DATA BLANK,DASH,ELL,EYE/1H ,1H-,1HL,1HI/
      DATA (TIPE(I),I=1,10)/5HSINGL,3HE  ,5HAVERA,3HGE ,5HCOMPL,3HETE,
     1 5HCENTR,3HOID,5HVARIA,3HNCE/
      DATA STARS/5H*****/
C
  102 READ(5,1) NA,NB,IND,IND1,IND2
    1 FORMAT(5I4)
      IF(NA.LE.0) STOP
C
C            NA IS THE NUMBER OF SPECIES
C            NB IS THE NUMBER OF CHARACTERS
C            IND IS     0   IF CHARACTER STATE TREES PRECEDE THE DATA BUT
C                          THEY ARE TO BE IGNORED
C                       1   IF  THEY ARE TO BE USED TO FIND PRIMITIVE
C                          STATE AND IGNORE SIMILARITY FOR IT
C            IND1       TELLS TYPE OF LINKAGE TO USE -
C                          0   SINGLE LINKAGE
C                          1   AVERAGE LINAKGE
C                          2   COMPLETE LINAKGE
C                          3   CENTROID LINKAGE
C                          4   VARIANCE LINKAGE
C            NOTE - SINGLE LINKAGE IS THE ONLY ONE WHICH WILL NEVER
C            GIVE *REVERSALS* WHERE LARGER GROUPS CLUSTER AT HIGHER
C            LEVELS THAN SOME OF THEIR COMPONENTS
C            IND2       0  IF UNWEIGHTED
C                       1   IF WEIGHTED
C                  NOTE - NOT RELEVANT FOR SINGLE OR COMPLETE LINKAGE,
C                  CAN BE ANY VALUE FOR THEM
      DO 500 IA=1,NA
  500 TN(IA)=1.
      DO 3 IA=1,NA
      READ(5,2) B(IA,1),B(IA,2),(IB(IA,J),J=1,NB)
    2 FORMAT(2A5,70I1)
      IF(B(IA,1).NE.STARS) GO TO 3
  600 READ(5,601) II
  601 FORMAT(I4,2A5)
      IJ=II-1
      READ(5,2) B(IA,1),B(IA,2),(IB(IA,J),J=1,NB)
      DO 604 IK=1,IJ
      READ(5,603)
  603 FORMAT(80X)
  604 CONTINUE
    3 CONTINUE
      DO 466 IA=1,NB
      IF(IND-2) 460,465,465
  460 READ(5,467) (IG(I),I=1,7),IGG
  467 FORMAT(7I2,4X,I2)
      IF(IND-1) 465,468,465
  468 IF(IGG) 461,462,485
  485 IF(IGG-3) 465,462,465
  461 IP(IA)=-1
      GO TO 466
  462 DO 464 IC=1,7
      IF(IG(IC)-10) 464,463,464
  463 IP(IA)=IC-1
  464 CONTINUE
      GO TO 466
  465 IP(IA)=9
  466 CONTINUE
  469 CB=NB
      DO 6 IA=1,NA
      DO 6 IC=1,NA
      SUMM=0.0
      SUMU1=0.0
      DO 80 ID=1,NB
      IL=IB(IA,ID)
      IF(IL-9) 70,80,80
      IR=IB(IC,ID)
   70 IF(IR-9) 71,80,80
   71 IF(IP(ID)) 80,72,72
   72 SUMU1=SUMU1&1.0
      IF(IND-1) 75,74,75
   74 IF(IL-IP(ID)) 75,80,75
   75 IF(IL-IR) 80,76,80
   76 SUMM=SUMM&1.0
   80 CONTINUE
      AN=SUMU1
      IF(AN) 81,81,605
   81 A(IA,IC)=0.
      GO TO 6
  605 A(IA,IC)=SUMM/SUMU1
    6 CONTINUE
      DO 200 IA=1,NA
      DO 200 IC=1,NA
  200 T(IA,IC)=A(IA,IC)
      DO 62 IA=1,NA
   62 KB(IA)=IA
   65 NAA=NA-1
      DO 112 IA=1,NAA
      JA=1
      JB=2
      DO 9 IC=1,NAA
      NAB=IC&1
      DO 9 ID=NAB,NA
      IF(A(JA,JB)-A(IC,ID)) 8,9,9
    8 JA=IC
      JB=ID
    9 CONTINUE
      KA(JB)=JA
      C(JB)=A(JA,JB)
      DO 11 IC=1,NA
      IF(IC-JA) 95,11,95
   95 IF(IC-JB) 96,11,96
   96 IF(IND1-1) 10,105,106
   10 A(IC,JA)=AMAX1(A(IC,JA),A(IC,JB))
      GO TO 110
  105 A(IC,JA)=(TN(JA)*A(IC,JA)&TN(JB)*A(IC,JB))/(TN(JA)&TN(JB))
      GO TO 110
  106 IF(IND1-3) 107,108,109
  107 A(IC,JA)=AMIN1(A(IC,JA),A(IC,JB))
      GO TO 110
  108 A(IC,JA)=(TN(JA)*A(IC,JA)&TN(JB)*A(IC,JB))/(TN(JA)&TN(JB))&
     1(TN(JA)*TN(JB)*(1.-A(JA,JB)))/(TN(JA)&TN(JB))**2
      GO TO 110
  109 TAB=TN(IC)&TN(JA)
      TAC=TN(IC)&TN(JB)
      TBC=TN(JA)&TN(JB)
      TABC=TN(IC)&TN(JA)&TN(JB)
      A(IC,JA)=(TAB*(TAB-1.)*A(IC,JA)&TAC*(TAC-1.)*A(IC,JB)&TBC*(TBC-1.)
     1*A(JA,JB)-TN(IC)*(TN(IC)-1.)*A(IC,IC)-TN(JA)*(TN(JA)-1.)*A(JA,JA)
     2-TN(JB)*(TN(JB)-1.)*A(JB,JB))/( TABC*(TABC-1.))
  110 A(JA,IC)=A(IC,JA)
      A(IC,JB)=-1.
      A(JB,IC)=-1.
   11 CONTINUE
      A(JA,JB)=-1.
      A(JB,JA)=-1.
      A(JA,JA)=C(JB)
      IF(IND2) 111,111,112
  111 TN(JA)=TN(JA)&TN(JB)
  112 CONTINUE
   12 IC=1
  125 IA=2
   13 IF(IA-NA&1) 14,14,20
   14 IF(KA(IA&1)-IC) 19,15,19
   15 IF(KA(IA&1)-KB(IA)) 16,19,16
   16 IF(KA(IA&1)-KA(IA)) 18,17,18
   17 IF(C(IA&1)-C(IA)) 19,19,18
   18 ID=KB(IA&1)
      KB(IA&1)=KB(IA)
      KB(IA)=ID
      ID=KA(IA&1)
      KA(IA&1)=KA(IA)
      KA(IA)=ID
      D=C(IA&1)
      C(IA&1)=C(IA)
      C(IA)=D
      GO TO 125
   19 IA=IA&1
      GO TO 13
   20 IC=IC&1
      IF(IC-NA) 125,299,299
  299 WRITE(6,400)
  400 FORMAT(1H1/1X,3X,4HNAME,13X,10HCHARACTERS/1X)
      DO 405 IA=1,NA
      WRITE(6,402) B(IA,1),B(IA,2),(IB(IA,I),I=1,NB)
  402 FORMAT(1X,2A5,5X,14(5I1,1X))
  405 CONTINUE
      WRITE(6,305)
      IF(IND-1) 480,470,480
  470 WRITE(6,471)
  471 FORMAT(1X,16HPRIMITIVE STATES//1X,4HCHAR,6X,10HPRIM STATE/1X)
      DO 479 IA=1,NB
      IF(IP(IA)) 472,474,474
  472 WRITE(6,473) IA
  473 FORMAT(1X,I5,10X,4HOMIT)
      GO TO 479
  474 IF(IP(IA)-9) 477,475,475
  475 WRITE(6,476) IA
  476 FORMAT(1X,I5,10X,7HUNKNOWN)
      GO TO 479
  477 WRITE(6,478) IA,IP(IA)
  478 FORMAT(1X,I5,5X,I5)
  479 CONTINUE
  480 DO 300 IA=1,NA
      IC=KB(IA)
      DO 300 ID=1,NA
      IE=KB(ID)
  300 A(IA,ID)=T(IC,IE)
      ILO=1
  450 IUP=ILO&14
      IF(IUP-NA) 452,452,451
  451 IUP=NA
  452 WRITE(6,453) (I,I=ILO,IUP)
  453 FORMAT(1H1/1X,23X,15I6/1X)
      DO 455 IA=1,NA
      ID=KB(IA)
      WRITE(6,454) IA,B(ID,1),B(ID,2),(A(IA,I),I=ILO,IUP)
  454 FORMAT(1X,I5,5X,2A5,5X,15F6.3)
  455 CONTINUE
      IF(NA-IUP) 457,457,456
  456 ILO=IUP&1
      GO TO 450
  457 WRITE(6,305)
  305 FORMAT(1H1)
      IF(IND1-1) 201,202,203
  201 AA=TIPE(1)
      AB=TIPE(2)
      GO TO 204
  202 AA=TIPE(3)
      AB=TIPE(4)
      GO TO 204
  203 IF(IND1-3) 2031,2032,2033
 2031 AA=TIPE(5)
      AB=TIPE(6)
      GO TO 204
 2032 AA=TIPE(7)
      AB=TIPE(8)
      GO TO 204
 2033 AA=TIPE(9)
      AB=TIPE(10)
  204 WRITE(6,206) AA,AB
  206 FORMAT(1X,A5,A3,1X,14HLINKAGE METHOD/2X)
      IF(IND2) 2040,2040,2041
 2040 WRITE(6,2045)
 2045 FORMAT(1X,10HUNWEIGHTED/2X)
      GO TO 21
 2041 WRITE(6,2046)
 2046 FORMAT(1X,8HWEIGHTED/2X)
   21 WRITE(6,22) B(1,1),B(1,2)
   220FORMAT(1X,1H0,9X,1H1,9X,1H2,9X,1H3,9X,1H4,9X,1H5,9X,1H6,9X,1H7,
     19X,1H8,9X,1H9,9X,2H10,4X,4HNAME//1X,100(1H-),2X,2A5,2I5,F6.3)
      DO 265 IA=2,NA
      IX=100.*C(IA)
      IX=IX&1
      IF(IX-100) 24,24,23
   23 IX=100
   24 DO 25 IC=1,100
   25 E(IC)=BLANK
      DO 26 IC=IX,100
   26 E(IC)=DASH
      E(IX)=ELL
      IF(IA-NA) 27,295,295
   27 IX=IA&1
      CA=C(IA)
      DO 29 IC=IX,NA
      IF(C(IC)-CA) 28,29,29
   28 IY=100.*C(IC)&1.0
      E(IY)=EYE
      CA=C(IC)
   29 CONTINUE
  295 IX=KB(IA)
      WRITE(6,30) (E(I),I=1,100),B(IX,1),B(IX,2),C(IA)
   30 FORMAT(1X,100A1,2X,2A5,F10.4)
  265 CONTINUE
      WRITE(6,40)
   40 FORMAT(1H1)
      GO TO 102
      END

   5   8   0   1   0
A         01111000
B         01101102
C         10010101
D         01111112
E         11010101
10 0-1-1-1-1-1-1-1
10 0-1-1-1-1-1-1-1
10 0-1-1-1-1-1-1-1
10 0-1-1-1-1-1-1-1
10 0-1-1-1-1-1-1-1
10 0-1-1-1-1-1-1-1
10 0-1-1-1-1-1-1-1
10 0 1-1-1-1-1-1-1
